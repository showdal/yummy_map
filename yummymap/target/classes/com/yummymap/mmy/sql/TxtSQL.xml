<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper
 			PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 					"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tSQL">
	<select id="tList" resultType="tVO">
	SELECT
		rno, txtno, mid, title, rnum, category,
		cdate, count
	FROM
		(SELECT
			ROWNUM rno, txtno, mid, title, rnum, category,
			TO_CHAR(cdate,'yyyy-MM-dd  hh24:mi:ss') cdate, count
		FROM
			txt t, category c
		WHERE
			isshow = 'Y'
			AND t.catno=c.catno
		ORDER BY
			txtno DESC
		)
	<!-- 	WHERE
			rno BETWEEN #{rno} AND #{rno} --> 
	</select>
	<insert id="tWrite">
		INSERT INTO txt(
			txtno, title,  mid, catno, mtxt 
		) VALUES (
			getTxtno.nextval, #{title}, #{mid}, #{catno}, #{mtxt}
		)
	</insert>
	<select id="tDetail" resultType="tVO" parameterType="int">
		SELECT
			txtno, title, mtxt, mid, cdate, count, rnum, catno
		FROM
			txt
		WHERE
			txtno = #{txtno}
			AND isshow='Y'
	</select>
	<update id="tDelete">
		UPDATE txt
		SET isshow = 'N' 
		WHERE txtno = #{txtno}
	</update>
	<update id="tEdit"  parameterType="tVO">
		UPDATE txt
		SET	title = #{title},
			mtxt = #{mtxt},
			catno = #{catno}
		WHERE txtno = #{txtno}
	</update>
	<update id="tCount" parameterType="int">
		UPDATE txt
		SET count = count+1
		WHERE txtno = #{txtno}
	</update>
	
	<update id="tUp" parameterType="int">
		UPDATE txt
		SET rnum = rnum + 1
		WHERE txtno = #{txtno}
	</update>
	<update id="tDown" parameterType="int">
		UPDATE txt
		SET rnum = rnum - 1
		WHERE txtno = #{txtno}
	</update>
	<select id="tRecommend" parameterType="tVO">
		SELECT
			recomno, m.mid, txtno, isrec
		FROM
			recommend r, member m, txt t
		WHERE
			m.mid = r.mid
			AND txtno = #{txtno}
			AND isrec = 'Y'
	</select>
	<insert id="tRecY" parameterType="tVO">
		INSERT INTO recommend(
			recomno, mid, txtno
		)
		VALUES(
			getRecomno.nextval, #{mid}, #{txtno}
		)
	</insert>
	<update id="tRecN" parameterType="tVO">
		UPDATE recommend
		SET isrec='N'
		WHERE txtno=#{txtno}
		AND mid=#{mid}
	</update>
	
	
</mapper>